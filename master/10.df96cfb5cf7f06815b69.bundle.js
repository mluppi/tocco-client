(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{2065:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _ACTION_HANDLERS,reducer=__webpack_require__(406),es=__webpack_require__(49),index_es=__webpack_require__(17),actionEmitter=__webpack_require__(135),classCallCheck=(__webpack_require__(31),__webpack_require__(1117),__webpack_require__(71),__webpack_require__(174),__webpack_require__(140),__webpack_require__(42)),classCallCheck_default=__webpack_require__.n(classCallCheck),createClass=__webpack_require__(48),createClass_default=__webpack_require__.n(createClass),possibleConstructorReturn=__webpack_require__(43),possibleConstructorReturn_default=__webpack_require__.n(possibleConstructorReturn),getPrototypeOf=__webpack_require__(44),getPrototypeOf_default=__webpack_require__.n(getPrototypeOf),assertThisInitialized=__webpack_require__(32),assertThisInitialized_default=__webpack_require__.n(assertThisInitialized),inherits=__webpack_require__(45),inherits_default=__webpack_require__.n(inherits),defineProperty=__webpack_require__(4),defineProperty_default=__webpack_require__.n(defineProperty),react=(__webpack_require__(9),__webpack_require__(0)),react_default=__webpack_require__.n(react),react_router=__webpack_require__(440),src=__webpack_require__(5),appFactory=(__webpack_require__(100),__webpack_require__(82)),notifier=__webpack_require__(54),errorLogging=__webpack_require__(113),externalEvents=__webpack_require__(72),actions=__webpack_require__(128),formData=__webpack_require__(224),keyDown=__webpack_require__(1054),main=__webpack_require__(1053),src_main=__webpack_require__(571),src_reducer=__webpack_require__(51),LOAD_DETAIL_VIEW=(__webpack_require__(346),__webpack_require__(97),"entityDetail/LOAD_DETAIL_VIEW"),SUBMIT_FORM="entityDetail/SUBMIT_FORM",SET_LAST_SAVE="entityDetail/SET_LAST_SAVE",UNLOAD_DETAIL_VIEW="entityDetail/UNLOAD_DETAIL_VIEW",FIRE_TOUCHED="entityDetail/FIRE_TOUCHED",TOUCH_ALL_FIELDS="entityDetail/TOCH_ALL_FIELDS",NAVIGATE_TO_CREATE="entityDetail/NAVIGATE_TO_CREATE",setFormDefinition=function(formDefinition){return{type:"entityDetail/SET_FORM_DEFINITION",payload:{formDefinition:formDefinition}}},loadDetailView=function(modelPaths,entityId){return{type:LOAD_DETAIL_VIEW,payload:{modelPaths:modelPaths,entityId:entityId}}},setEntity=function(entity){return{type:"entityDetail/SET_ENTITY",payload:{entity:entity}}},submitForm=function(){return{type:SUBMIT_FORM}},setLastSave=function(){var lastSave=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();return{type:SET_LAST_SAVE,payload:{lastSave:lastSave}}},setEntityModel=function(entityModel){return{type:"entityDetail/SET_ENTITY_MODEL",payload:{entityModel:entityModel}}},unloadDetailView=function(){return{type:UNLOAD_DETAIL_VIEW}},setTouched=function(touched){return{type:"entityDetail/SET_TOUCHED",payload:{touched:touched}}},navigateToCreate=function(relationName){return{type:NAVIGATE_TO_CREATE,payload:{relationName:relationName}}},ACTION_HANDLERS=(_ACTION_HANDLERS={},defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_ENTITY_NAME",src_reducer.a.singleTransferReducer("entityName")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_FORM_NAME",src_reducer.a.singleTransferReducer("formName")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_ENTITY_ID",src_reducer.a.singleTransferReducer("entityId")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_MODE",src_reducer.a.singleTransferReducer("mode")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_FORM_DEFINITION",src_reducer.a.singleTransferReducer("formDefinition")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_ENTITY",src_reducer.a.singleTransferReducer("entity")),defineProperty_default()(_ACTION_HANDLERS,SET_LAST_SAVE,src_reducer.a.singleTransferReducer("lastSave")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_ENTITY_MODEL",src_reducer.a.singleTransferReducer("entityModel")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_TOUCHED",src_reducer.a.singleTransferReducer("touched")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_APP_ID",src_reducer.a.singleTransferReducer("appId")),defineProperty_default()(_ACTION_HANDLERS,"entityDetail/SET_DEFAULT_VALUES",src_reducer.a.singleTransferReducer("defaultValues")),_ACTION_HANDLERS),initialState={appId:"",entityName:"",formName:"",mode:"update",formDefinition:{},entity:{},entityModel:{},touched:!1,defaultValues:{}};__webpack_require__(20),__webpack_require__(69),__webpack_require__(96),__webpack_require__(28),__webpack_require__(23),__webpack_require__(65),__webpack_require__(34),__webpack_require__(27),__webpack_require__(8),__webpack_require__(29),__webpack_require__(33),__webpack_require__(19),__webpack_require__(50),__webpack_require__(73),__webpack_require__(24),__webpack_require__(68);var toConsumableArray=__webpack_require__(63),toConsumableArray_default=__webpack_require__.n(toConsumableArray),regenerator=__webpack_require__(3),regenerator_default=__webpack_require__.n(regenerator),es_actions=(__webpack_require__(62),__webpack_require__(89)),SubmissionError=__webpack_require__(570),getFormValues=__webpack_require__(253),src_form=__webpack_require__(91),rest=__webpack_require__(57),effects=__webpack_require__(1);__webpack_require__(131),__webpack_require__(83),__webpack_require__(121);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?ownKeys(source,!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}var _marked=regenerator_default.a.mark(fetchEntity),_marked2=regenerator_default.a.mark(updateEntity),_marked3=regenerator_default.a.mark(createEntity),_marked4=regenerator_default.a.mark(fetchModel);function fetchEntity(entityName,id,paths,formName){var options,resp;return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return options={queryParams:{_paths:paths.join(","),_form:formName}},_context.next=3,Object(effects.b)(rest.a.requestSaga,"entities/".concat(entityName,"/").concat(id),options);case 3:return resp=_context.sent,_context.abrupt("return",resp.body);case 5:case"end":return _context.stop()}},_marked)}function updateEntity(entity){var paths,options,resource,resp,_args2=arguments;return regenerator_default.a.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return paths=1<_args2.length&&void 0!==_args2[1]?_args2[1]:[],options={method:"PATCH",queryParams:{_paths:paths.join(",")},body:entity,acceptedErrorCodes:["VALIDATION_FAILED"]},resource="entities/".concat(entity.model,"/").concat(entity.key),_context2.next=5,Object(effects.b)(rest.a.requestSaga,resource,options);case 5:if("VALIDATION_FAILED"!==(resp=_context2.sent).body.errorCode){_context2.next=8;break}throw new SubmissionError.a(src_form.a.validationErrorToFormError(entity,resp.body.errors));case 8:return _context2.abrupt("return",resp.body);case 9:case"end":return _context2.stop()}},_marked2)}var SUCCESSFUL_SAVED_STATUS=201;function createEntity(entity){var paths,options,resource,resp,location,id,_args3=arguments;return regenerator_default.a.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return paths=1<_args3.length&&void 0!==_args3[1]?_args3[1]:[],options={method:"POST",queryParams:{_paths:paths.join(",")},body:entity,acceptedErrorCodes:["VALIDATION_FAILED"]},resource="entities/".concat(entity.model),_context3.next=5,Object(effects.b)(rest.a.requestSaga,resource,options);case 5:if((resp=_context3.sent).status!==SUCCESSFUL_SAVED_STATUS){_context3.next=12;break}return location=resp.headers.get("Location"),id=location.split("/").pop(),_context3.abrupt("return",id);case 12:if(!resp.body||"VALIDATION_FAILED"!==resp.body.errorCode){_context3.next=14;break}throw new SubmissionError.a(src_form.a.validationErrorToFormError(entity,resp.body.errors));case 14:throw new Error("unexpected error during save",resp);case 15:case"end":return _context3.stop()}},_marked3)}var defaultModelTransformer=function(json){var model={};return json.fields.forEach(function(field){model[field.fieldName]=_objectSpread({},field)}),json.relations.forEach(function(relation){model[relation.relationName]=_objectSpread({type:"relation"},relation)}),model};function fetchModel(entityName){var transformer,resp,_args4=arguments;return regenerator_default.a.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return transformer=1<_args4.length&&void 0!==_args4[1]?_args4[1]:defaultModelTransformer,_context4.next=3,Object(effects.b)(rest.a.requestSaga,"entities/".concat(entityName,"/model"));case 3:return resp=_context4.sent,_context4.next=6,Object(effects.b)(transformer,resp.body);case 6:return _context4.abrupt("return",_context4.sent);case 7:case"end":return _context4.stop()}},_marked4)}__webpack_require__(232);var asyncToGenerator=__webpack_require__(908),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),get=__webpack_require__(41),get_default=__webpack_require__.n(get),modes={CREATE:"create",UPDATE:"update"};function asyncValidation_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function asyncValidation_objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?asyncValidation_ownKeys(source,!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):asyncValidation_ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}var asyncValidators=src_form.a.validators.asyncValidators,asyncValidation_AsyncValidationException=function AsyncValidationException(errors){classCallCheck_default()(this,AsyncValidationException),this.name="AsyncValidationException",this.errors=errors};asyncValidation_AsyncValidationException.prototype=Object.create(Error.prototype);var hasError=function(errors){return errors&&0<Object.keys(errors).length},asyncValidateTypes=function(){var _ref=asyncToGenerator_default()(regenerator_default.a.mark(function _callee(values,entityModel){var errors,key,value,type,typeValidator,fieldModel,validationError,error;return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:errors={},_context.t0=regenerator_default.a.keys(values);case 2:if((_context.t1=_context.t0()).done){_context.next=16;break}if(key=_context.t1.value,!(value=values[key])){_context.next=14;break}if(type=get_default()(entityModel,key+".type"),!(typeValidator=asyncValidators[type])){_context.next=14;break}return fieldModel=entityModel[key],_context.next=12,typeValidator(value,fieldModel);case 12:(validationError=_context.sent)&&(error=src_form.a.formErrorsUtil.addErrors(errors,key,validationError),errors=asyncValidation_objectSpread({},errors,{},error));case 14:_context.next=2;break;case 16:return _context.abrupt("return",errors);case 17:case"end":return _context.stop()}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),validateRequest=function(values,initialValues,entityName,entityId,entityModel,mode){var dirtyFields=src_form.a.getDirtyFields(initialValues,values),entity=src_form.a.formValuesToEntity(values,dirtyFields,entityName,entityId,entityModel),options={queryParams:{_validate:!0},method:mode===modes.CREATE?"POST":"PATCH",body:entity};return rest.a.simpleRequest("entities/".concat(entity.model).concat(entity.key?"/".concat(entity.key):""),options).then(function(resp){return resp.body}).then(function(body){return body.valid?{}:src_form.a.validationErrorToFormError(entity,body.errors)})},submitValidate=function(values,initialValues,entityName,entityId,entityModel,mode){return validateRequest(values,initialValues,entityName,entityId,entityModel,mode).then(function(errors){if(hasError(errors))throw new SubmissionError.a(errors)})},asyncValidate=function(){var _ref2=asyncToGenerator_default()(regenerator_default.a.mark(function _callee2(values,initialValues,entityName,entityId,entityModel,mode){var typeValidationErrors,validateRequestErrors;return regenerator_default.a.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,asyncValidateTypes(values,entityModel);case 2:if(typeValidationErrors=_context2.sent,!hasError(typeValidationErrors)){_context2.next=5;break}throw new asyncValidation_AsyncValidationException(typeValidationErrors);case 5:return _context2.next=7,validateRequest(values,initialValues,entityName,entityId,entityModel,mode);case 7:if(validateRequestErrors=_context2.sent,!hasError(validateRequestErrors)){_context2.next=10;break}throw new asyncValidation_AsyncValidationException(validateRequestErrors);case 10:case"end":return _context2.stop()}},_callee2)}));return function(){return _ref2.apply(this,arguments)}}();function sagas_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function sagas_objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?sagas_ownKeys(source,!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):sagas_ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}var sagas_marked=regenerator_default.a.mark(sagas),sagas_marked2=regenerator_default.a.mark(loadDetailFormDefinition),sagas_marked3=regenerator_default.a.mark(loadEntity),sagas_marked5=regenerator_default.a.mark(sagas_unloadDetailView),_marked6=regenerator_default.a.mark(loadEntityModel),_marked7=regenerator_default.a.mark(sagas_loadDetailView),_marked8=regenerator_default.a.mark(updateFormSubmit),_marked9=regenerator_default.a.mark(createFormSubmit),_marked10=regenerator_default.a.mark(sagas_touchAllFields),_marked11=regenerator_default.a.mark(handleSubmitError),_marked12=regenerator_default.a.mark(getEntityForSubmit),_marked13=regenerator_default.a.mark(getPaths),_marked14=regenerator_default.a.mark(sagas_submitForm),_marked15=regenerator_default.a.mark(sagas_fireTouched),_marked16=regenerator_default.a.mark(showNotification),_marked17=regenerator_default.a.mark(loadData),_marked18=regenerator_default.a.mark(actionInvoked),_marked19=regenerator_default.a.mark(sagas_navigateToCreate),formInitialValueSelector=function(formId){return function(state){return state.form[formId].initial}},entityDetailSelector=function(state){return state.entityDetail},FORM_ID="detailForm";function sagas(){return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Object(effects.a)([Object(effects.c)(effects.i,LOAD_DETAIL_VIEW,sagas_loadDetailView),Object(effects.c)(effects.i,UNLOAD_DETAIL_VIEW,sagas_unloadDetailView),Object(effects.c)(effects.i,TOUCH_ALL_FIELDS,sagas_touchAllFields),Object(effects.c)(effects.h,SUBMIT_FORM,sagas_submitForm),Object(effects.c)(effects.h,FIRE_TOUCHED,sagas_fireTouched),Object(effects.c)(effects.h,NAVIGATE_TO_CREATE,sagas_navigateToCreate),Object(effects.c)(effects.h,actions.a.actions.ACTION_INVOKED,actionInvoked)]);case 2:case"end":return _context.stop()}},sagas_marked)}function loadDetailFormDefinition(formName){var formDefinition;return regenerator_default.a.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Object(effects.b)(src_form.a.fetchForm,formName);case 2:return formDefinition=_context2.sent,_context2.next=5,Object(effects.d)(setFormDefinition(formDefinition));case 5:return _context2.abrupt("return",formDefinition);case 6:case"end":return _context2.stop()}},sagas_marked2)}function loadEntity(entityName,entityId,formDefinition,formName){var fieldDefinitions,paths,entity;return regenerator_default.a.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Object(effects.b)(src_form.a.getFieldDefinitions,formDefinition);case 2:return fieldDefinitions=_context3.sent,_context3.next=5,Object(effects.b)(src_form.a.getUsedPaths,fieldDefinitions);case 5:return paths=_context3.sent,_context3.next=8,Object(effects.b)(fetchEntity,entityName,entityId,paths,formName);case 8:return entity=_context3.sent,_context3.next=11,Object(effects.d)(setEntity(entity));case 11:return _context3.abrupt("return",entity);case 12:case"end":return _context3.stop()}},sagas_marked3)}function sagas_unloadDetailView(){return regenerator_default.a.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,Object(effects.d)(setEntity(null));case 2:return _context5.next=4,Object(effects.d)(es_actions.a.destroy(FORM_ID));case 4:case"end":return _context5.stop()}},sagas_marked5)}function loadEntityModel(entityName){var entityModel;return regenerator_default.a.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,Object(effects.b)(fetchModel,entityName);case 2:return entityModel=_context6.sent,_context6.next=5,Object(effects.d)(setEntityModel(entityModel));case 5:return _context6.abrupt("return",entityModel);case 6:case"end":return _context6.stop()}},_marked6)}function sagas_loadDetailView(){var _ref,entityName,formName,mode,defaultValues,model,formDefinition,fieldDefinitions,formDefaultValues,inputDefaultValues,defaultValuesFields;return regenerator_default.a.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,Object(effects.e)(entityDetailSelector);case 2:return _ref=_context7.sent,entityName=_ref.entityName,formName=_ref.formName,mode=_ref.mode,defaultValues=_ref.defaultValues,_context7.next=9,Object(effects.b)(loadEntityModel,entityName);case 9:return model=_context7.sent,_context7.next=12,Object(effects.b)(loadDetailFormDefinition,formName);case 12:if(formDefinition=_context7.sent,mode!==modes.CREATE){_context7.next=32;break}return _context7.next=16,Object(effects.d)(setEntity({paths:{},model:entityName}));case 16:return _context7.next=18,Object(effects.b)(src_form.a.getFieldDefinitions,formDefinition);case 18:return fieldDefinitions=_context7.sent,_context7.next=21,Object(effects.b)(src_form.a.getDefaultValues,fieldDefinitions);case 21:return formDefaultValues=_context7.sent,_context7.next=24,Object(effects.b)(src_form.a.loadDisplaysOfRelationFields,defaultValues,model);case 24:return inputDefaultValues=_context7.sent,defaultValuesFields=sagas_objectSpread({},formDefaultValues,{},inputDefaultValues),_context7.next=28,Object(effects.d)(es_actions.a.initialize(FORM_ID,{}));case 28:return _context7.next=30,Object(effects.a)(Object.keys(defaultValuesFields).map(function(key){return Object(effects.d)(es_actions.a.change(FORM_ID,key,defaultValuesFields[key]))}));case 30:_context7.next=34;break;case 32:return _context7.next=34,Object(effects.b)(loadData);case 34:case"end":return _context7.stop()}},_marked7)}function updateFormSubmit(entity,paths){var updatedEntity,updatedFormValues;return regenerator_default.a.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,Object(effects.b)(updateEntity,entity,paths);case 2:return updatedEntity=_context8.sent,_context8.next=5,Object(effects.b)(src_form.a.entityToFormValues,updatedEntity);case 5:return updatedFormValues=_context8.sent,_context8.next=8,Object(effects.d)(es_actions.a.initialize(FORM_ID,updatedFormValues));case 8:return _context8.next=10,Object(effects.b)(showNotification,"success","saveSuccessfulTitle","saveSuccessfulMessage");case 10:return _context8.next=12,Object(effects.d)(setLastSave());case 12:return _context8.next=14,Object(effects.d)(es_actions.a.stopSubmit(FORM_ID));case 14:case"end":return _context8.stop()}},_marked8)}function createFormSubmit(entity,paths){var createdEntityId;return regenerator_default.a.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,Object(effects.b)(createEntity,entity,paths);case 2:return createdEntityId=_context9.sent,_context9.next=5,Object(effects.d)(externalEvents.a.fireExternalEvent("onEntityCreated",{id:createdEntityId}));case 5:return _context9.next=7,Object(effects.b)(showNotification,"success","createSuccessfulTitle","createSuccessfulMessage");case 7:case"end":return _context9.stop()}},_marked9)}function sagas_touchAllFields(){var _ref2,formDefinition,fieldDefinitions;return regenerator_default.a.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,Object(effects.e)(entityDetailSelector);case 2:return _ref2=_context10.sent,formDefinition=_ref2.formDefinition,_context10.next=6,Object(effects.b)(src_form.a.getFieldDefinitions,formDefinition);case 6:return fieldDefinitions=_context10.sent,_context10.next=9,Object(effects.d)(es_actions.a.touch.apply(es_actions.a,[FORM_ID].concat(toConsumableArray_default()(fieldDefinitions.map(function(f){return f.id})))));case 9:case"end":return _context10.stop()}},_marked10)}function handleSubmitError(error){return regenerator_default.a.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!(error instanceof SubmissionError.a)){_context11.next=7;break}return _context11.next=3,Object(effects.b)(sagas_touchAllFields);case 3:return _context11.next=5,Object(effects.d)(es_actions.a.stopSubmit(FORM_ID,error.errors));case 5:_context11.next=12;break;case 7:if(error instanceof rest.a.ClientQuestionCancelledException){_context11.next=10;break}return _context11.next=10,Object(effects.d)(errorLogging.a.logError("client.common.unexpectedError","client.entity-detail.saveError",error));case 10:return _context11.next=12,Object(effects.d)(es_actions.a.stopSubmit(FORM_ID));case 12:return _context11.next=14,Object(effects.b)(showNotification,"warning","saveAbortedTitle","saveAbortedMessage",5e3);case 14:case"end":return _context11.stop()}},_marked11)}function getEntityForSubmit(){var values,initialValues,_ref3,entityName,entityId,entityModel,mode,dirtyFields;return regenerator_default.a.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.next=2,Object(effects.e)(Object(getFormValues.a)(FORM_ID));case 2:return values=_context12.sent,_context12.next=5,Object(effects.e)(formInitialValueSelector(FORM_ID));case 5:return initialValues=_context12.sent,_context12.next=8,Object(effects.d)(es_actions.a.startSubmit(FORM_ID));case 8:return _context12.next=10,Object(effects.e)(entityDetailSelector);case 10:return _ref3=_context12.sent,entityName=_ref3.entityName,entityId=_ref3.entityId,entityModel=_ref3.entityModel,mode=_ref3.mode,_context12.next=17,Object(effects.b)(submitValidate,values,initialValues,entityName,entityId,entityModel,mode);case 17:return _context12.next=19,Object(effects.b)(src_form.a.getDirtyFields,initialValues,values,mode===modes.CREATE);case 19:return dirtyFields=_context12.sent,_context12.next=22,Object(effects.b)(src_form.a.formValuesToEntity,values,dirtyFields,entityName,entityId,entityModel);case 22:return _context12.abrupt("return",_context12.sent);case 23:case"end":return _context12.stop()}},_marked12)}function getPaths(){var _ref4,formDefinition,fieldDefinitions;return regenerator_default.a.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.next=2,Object(effects.e)(entityDetailSelector);case 2:return _ref4=_context13.sent,formDefinition=_ref4.formDefinition,_context13.next=6,Object(effects.b)(src_form.a.getFieldDefinitions,formDefinition);case 6:return fieldDefinitions=_context13.sent,_context13.next=9,Object(effects.b)(src_form.a.getUsedPaths,fieldDefinitions);case 9:return _context13.abrupt("return",_context13.sent);case 10:case"end":return _context13.stop()}},_marked13)}function sagas_submitForm(){var _ref5,mode,entity,paths;return regenerator_default.a.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.prev=0,_context14.next=3,Object(effects.e)(entityDetailSelector);case 3:return _ref5=_context14.sent,mode=_ref5.mode,_context14.next=7,Object(effects.b)(getEntityForSubmit);case 7:return entity=_context14.sent,_context14.next=10,Object(effects.b)(getPaths);case 10:if(paths=_context14.sent,mode!==modes.UPDATE){_context14.next=16;break}return _context14.next=14,Object(effects.b)(updateFormSubmit,entity,paths);case 14:_context14.next=19;break;case 16:if(mode!==modes.CREATE){_context14.next=19;break}return _context14.next=19,Object(effects.b)(createFormSubmit,entity,paths);case 19:_context14.next=25;break;case 21:return _context14.prev=21,_context14.t0=_context14.catch(0),_context14.next=25,Object(effects.b)(handleSubmitError,_context14.t0);case 25:case"end":return _context14.stop()}},_marked14,null,[[0,21]])}function sagas_fireTouched(_ref6){var payload,actionTouched,_ref7,stateTouched;return regenerator_default.a.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return payload=_ref6.payload,actionTouched=payload.touched,_context15.next=4,Object(effects.e)(entityDetailSelector);case 4:if(_ref7=_context15.sent,stateTouched=_ref7.touched,actionTouched===stateTouched){_context15.next=11;break}return _context15.next=9,Object(effects.d)(externalEvents.a.fireExternalEvent("onTouchedChange",{touched:actionTouched}));case 9:return _context15.next=11,Object(effects.d)(setTouched(actionTouched));case 11:case"end":return _context15.stop()}},_marked15)}function showNotification(type,titleResourceName,messageResourceName){var duration,_args16=arguments;return regenerator_default.a.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return duration=3<_args16.length&&void 0!==_args16[3]?_args16[3]:2e3,_context16.next=3,Object(effects.d)(notifier.a.info(type,"client.entity-detail.".concat(titleResourceName),"client.entity-detail.".concat(messageResourceName),"check",duration));case 3:case"end":return _context16.stop()}},_marked16)}function loadData(){var _ref8,entityName,entityId,formName,formDefinition,entity,formValues;return regenerator_default.a.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return _context17.next=2,Object(effects.e)(entityDetailSelector);case 2:return _ref8=_context17.sent,entityName=_ref8.entityName,entityId=_ref8.entityId,formName=_ref8.formName,formDefinition=_ref8.formDefinition,_context17.next=9,Object(effects.b)(loadEntity,entityName,entityId,formDefinition,formName);case 9:return entity=_context17.sent,_context17.next=12,Object(effects.b)(src_form.a.entityToFormValues,entity);case 12:return formValues=_context17.sent,_context17.next=15,Object(effects.d)(es_actions.a.initialize(FORM_ID,formValues,{keepDirty:!0}));case 15:case"end":return _context17.stop()}},_marked17)}function actionInvoked(action){return regenerator_default.a.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,Object(effects.b)(loadData);case 2:return _context18.next=4,Object(effects.d)(actionEmitter.a.emitAction(action));case 4:case"end":return _context18.stop()}},_marked18)}function sagas_navigateToCreate(_ref9){var payload;return regenerator_default.a.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return payload=_ref9.payload,_context19.next=3,Object(effects.d)(externalEvents.a.fireExternalEvent("onNavigateToCreate",payload.relationName));case 3:case"end":return _context19.stop()}},_marked19)}var reducers={entityDetail:function reducer_reducer(){var state=0<arguments.length&&void 0!==arguments[0]?arguments[0]:initialState,action=1<arguments.length?arguments[1]:void 0,handler=ACTION_HANDLERS[action.type];return handler?handler(state,action):state},form:reducer.a},reducers_sagas=[sagas],es_getFormInitialValues=function createGetFormInitialValues(_ref){var getIn=_ref.getIn;return function(form,getFormState){return function(state){var nonNullGetFormState=getFormState||function(state){return getIn(state,"form")};return getIn(nonNullGetFormState(state),form+".initial")}}}(__webpack_require__(64).a),isEmpty=__webpack_require__(158),isEmpty_default=__webpack_require__.n(isEmpty),getFormSyncErrors=__webpack_require__(1057),getFormAsyncErrors=__webpack_require__(1058),getFormSubmitErrors=__webpack_require__(1056),reduxForm=__webpack_require__(280),src_formField=__webpack_require__(225),SubGrid=function(props){var formBase="".concat(props.detailFormName,"_").concat(props.gridName);return react_default.a.createElement(src_main.a,{id:"".concat(props.appId,"-subgrid-").concat(formBase),keepStore:!0,entityName:props.modelField.targetEntity,formBase:formBase,limit:props.limit,showSearchForm:props.showSearchForm,onRowClick:function onRowClick(e){props.onRowClick&&props.onRowClick({id:e.id,gridName:props.gridName,relationName:props.relationName})},onNavigateToCreate:function onNavigateToCreate(){props.navigateToCreate(props.relationName)},emitAction:function emitAction(action){props.dispatchEmittedAction(action)},parent:{key:props.entityKey,reverseRelationName:props.modelField.reverseRelationName,model:props.entityName}})};SubGrid.displayName="SubGrid",SubGrid.defaultProps={limit:5};var SubGrid_SubGrid=SubGrid;SubGrid.__docgenInfo={description:"",methods:[],displayName:"SubGrid",props:{limit:{defaultValue:{value:"5",computed:!1},type:{name:"number"},required:!1,description:""},entityKey:{type:{name:"union",value:[{name:"string"},{name:"number"}]},required:!1,description:""},entityName:{type:{name:"string"},required:!0,description:""},detailFormName:{type:{name:"string"},required:!0,description:""},gridName:{type:{name:"string"},required:!0,description:""},relationName:{type:{name:"string"},required:!0,description:""},modelField:{type:{name:"shape",value:{targetEntity:{name:"string",required:!1},reverseRelationName:{name:"string",required:!1}}},required:!0,description:""},onRowClick:{type:{name:"func"},required:!1,description:""},navigateToCreate:{type:{name:"func"},required:!0,description:""},dispatchEmittedAction:{type:{name:"func"},required:!0,description:""},showSubGridsCreateButton:{type:{name:"bool"},required:!1,description:""},appId:{type:{name:"string"},required:!1,description:""},showSearchForm:{type:{name:"bool"},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/entity-detail/src/components/SubGrid/SubGrid.js"]={name:"SubGrid",docgenInfo:SubGrid.__docgenInfo,path:"packages/entity-detail/src/components/SubGrid/SubGrid.js"});var components_SubGrid=SubGrid_SubGrid,mapActionCreators={onRowClick:function onRowClick(e){return externalEvents.a.fireExternalEvent("onSubGridRowClick",{id:e.id,gridName:e.gridName,relationName:e.relationName})},navigateToCreate:navigateToCreate,onNavigateToCreate:function onNavigateToCreate(relationName){return externalEvents.a.fireExternalEvent("onNavigateToCreate",relationName)},dispatchEmittedAction:actionEmitter.a.dispatchEmittedAction},SubGridContainer=Object(es.connect)(function(state){return{appId:state.entityDetail.appId,entityKey:state.entityDetail.entity.key,entityName:state.entityDetail.entity.model,detailFormName:state.entityDetail.formDefinition.id,showSubGridsCreateButton:state.entityDetail.showSubGridCreateButton}},mapActionCreators)(components_SubGrid),subGrid=function(formField,modelField,key){return react_default.a.createElement(SubGridContainer,{key:key,gridName:formField.id,relationName:formField.id,modelField:modelField,showSearchForm:formField.showSearchForm,limit:formField.limit||void 0})},ErrorBox_ref2=react_default.a.createElement(index_es.FormattedMessage,{id:"client.entity-detail.invalidFieldsError"}),ErrorBox_ref3=react_default.a.createElement(index_es.FormattedMessage,{id:"client.entity-detail.validatorErrors"}),ErrorBox_ref4=react_default.a.createElement(index_es.FormattedMessage,{id:"client.entity-detail.invalidRelationErrors"}),components_ErrorBox=function(_ref){var formErrors=_ref.formErrors,showErrors=_ref.showErrors,output=null,elements=[];return src_form.a.formErrorsUtil.hasFieldErrors(formErrors)&&elements.push(react_default.a.createElement(src.n.Item,{condition:src.z.condition.DANGER,key:"hasFieldErrors"},react_default.a.createElement(src.h,{label:ErrorBox_ref2,neutral:!0,onClick:showErrors}))),src_form.a.formErrorsUtil.hasValidatorErrors(formErrors)&&elements.push(react_default.a.createElement(src.n.Item,{condition:src.z.condition.DANGER,key:"hasValidatorErrors"},ErrorBox_ref3,react_default.a.createElement(src.n.List,null,src_form.a.formErrorsUtil.getValidatorErrors(formErrors).map(function(message,idx){return react_default.a.createElement(src.n.Item,{condition:src.z.condition.DANGER,key:idx,label:message})})))),src_form.a.formErrorsUtil.hasRelatedEntityErrors(formErrors)&&elements.push(react_default.a.createElement(src.n.Item,{condition:src.z.condition.DANGER,key:"hasRelatedEntityErrors"},ErrorBox_ref4,react_default.a.createElement(src.n.List,null,src_form.a.formErrorsUtil.getRelatedEntityErrorsCompact(formErrors).map(function(message,idx){return react_default.a.createElement(src.n.Item,{condition:src.z.condition.DANGER,key:idx,label:message})})))),0<elements.length&&(output=react_default.a.createElement(src.m,{condition:src.z.condition.DANGER},react_default.a.createElement(src.n.List,null,elements.map(function(el){return el})))),output},readOnlyFormFieldMapping={binary:src_formField.a.formattedValueFactory("document"),birthdate:src_formField.a.formattedValueFactory("birthdate"),boolean:src_formField.a.formattedValueFactory("boolean"),code:src_formField.a.formattedValueFactory("text"),counter:src_formField.a.formattedValueFactory("string"),"data-amount":src_formField.a.formattedValueFactory("number"),date:src_formField.a.formattedValueFactory("date"),datetime:src_formField.a.formattedValueFactory("datetime"),time:src_formField.a.formattedValueFactory("time"),decimal:src_formField.a.formattedValueFactory("decimal"),display:src_formField.a.formattedValueFactory("html"),duration:src_formField.a.formattedValueFactory("duration"),document:src_formField.a.formattedValueFactory("document"),email:src_formField.a.formattedValueFactory("email"),html:src_formField.a.formattedValueFactory("html"),image:src_formField.a.formattedValueFactory("document"),identifier:src_formField.a.formattedValueFactory("string"),latitude:src_formField.a.formattedValueFactory("number"),login:src_formField.a.formattedValueFactory("string"),long:src_formField.a.formattedValueFactory("string"),longitude:src_formField.a.formattedValueFactory("number"),moneyamount:src_formField.a.formattedValueFactory("moneyamount"),"multi-remote-field":src_formField.a.formattedValueFactory("multi-remote"),"multi-select-box":src_formField.a.formattedValueFactory("multi-select"),"named-upload":src_formField.a.formattedValueFactory("document"),integer:src_formField.a.formattedValueFactory("number"),percent:src_formField.a.formattedValueFactory("number"),phone:src_formField.a.formattedValueFactory("phone"),"pulldown-date":src_formField.a.formattedValueFactory("date"),range:{date:src_formField.a.formattedValueFactory("date-range"),birthdate:src_formField.a.formattedValueFactory("date-range")},remote:src_formField.a.formattedValueFactory("remote"),"search-filter":src_formField.a.formattedValueFactory("search-filter"),"single-remote-field":src_formField.a.formattedValueFactory("remote"),"single-select-box":src_formField.a.formattedValueFactory("single-select"),sorting:src_formField.a.formattedValueFactory("number"),string:src_formField.a.formattedValueFactory("string"),text:src_formField.a.formattedValueFactory("text"),"text-area":src_formField.a.formattedValueFactory("text"),upload:src_formField.a.formattedValueFactory("document"),url:src_formField.a.formattedValueFactory("url"),uuid:src_formField.a.formattedValueFactory("string"),subTable:subGrid},taggedTemplateLiteral=__webpack_require__(61),taggedTemplateLiteral_default=__webpack_require__.n(taggedTemplateLiteral),styled_components_browser_esm=__webpack_require__(6);function _templateObject(){var data=taggedTemplateLiteral_default()(["\n  && {\n    margin-top: ",";\n  }\n"]);return _templateObject=function(){return data},data}var StyledDetailFormLastSaved=styled_components_browser_esm.default.div(_templateObject(),src.A.space(-1)),DetailForm_ref=react_default.a.createElement("div",null),DetailForm_ref3=react_default.a.createElement(index_es.FormattedMessage,{id:"client.entity-detail.lastSave"}),DetailForm_DetailForm=function(_React$Component){function DetailForm(){var _getPrototypeOf2,_this;classCallCheck_default()(this,DetailForm);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _this=possibleConstructorReturn_default()(this,(_getPrototypeOf2=getPrototypeOf_default()(DetailForm)).call.apply(_getPrototypeOf2,[this].concat(args))),defineProperty_default()(assertThisInitialized_default()(_this),"isReadOnlyForm",function(){return _this.props.formDefinition.readonly}),defineProperty_default()(assertThisInitialized_default()(_this),"isEntityLoaded",function(){return _this.props.entity&&_this.props.entity.paths}),defineProperty_default()(assertThisInitialized_default()(_this),"focusErrorFields",function(){var firstErrorField=src_form.a.formErrorsUtil.getFirstErrorField(_this.props.formErrors);firstErrorField&&(document.getElementById(src_form.a.getFieldId(_this.props.form,firstErrorField))&&document.getElementById(src_form.a.getFieldId(_this.props.form,firstErrorField)).focus())}),defineProperty_default()(assertThisInitialized_default()(_this),"save",function(){_this.props.valid?_this.props.submitForm():_this.props.formErrors&&_this.showErrors()}),defineProperty_default()(assertThisInitialized_default()(_this),"handleSubmit",function(event){event.preventDefault(),_this.save()}),defineProperty_default()(assertThisInitialized_default()(_this),"handleKeyPress",function(event){"Enter"===event.key&&"TEXTAREA"!==event.target.tagName&&event.preventDefault()}),defineProperty_default()(assertThisInitialized_default()(_this),"showErrors",function(event){event&&event.preventDefault(),_this.props.touchAllFields(),_this.focusErrorFields()}),defineProperty_default()(assertThisInitialized_default()(_this),"msg",function(id){return _this.props.intl.formatMessage({id:id})}),_this}return inherits_default()(DetailForm,_React$Component),createClass_default()(DetailForm,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){prevProps.dirty!==this.props.dirty&&this.props.fireTouched(this.props.dirty)}},{key:"render",value:function render(){var props=this.props;return this.isEntityLoaded()?react_default.a.createElement("form",{onSubmit:this.handleSubmit,onKeyDown:this.handleKeyPress},react_default.a.createElement(src_form.a.FormBuilder,{entity:props.entity,model:props.entityModel,formName:props.form,formDefinition:props.formDefinition,formValues:props.formValues,formFieldMapping:src_formField.a.defaultMapping,readOnlyFormFieldMapping:readOnlyFormFieldMapping,mode:props.mode,componentMapping:defineProperty_default()({},src_form.a.componentTypes.SUB_TABLE,subGrid)}),!this.isReadOnlyForm()&&react_default.a.createElement(react_default.a.Fragment,null,!props.valid&&props.anyTouched&&react_default.a.createElement(components_ErrorBox,{formErrors:props.formErrors,showErrors:this.showErrors}),react_default.a.createElement(src.a,{"data-cy":"detail-form_submit-button",disabled:props.submitting||props.anyTouched&&!props.valid,ink:"primary",label:this.msg("client.entity-detail.".concat(props.mode===modes.CREATE?"create":"save")),look:"raised",pending:props.submitting,type:"submit"}),props.lastSave&&react_default.a.createElement(StyledDetailFormLastSaved,null,react_default.a.createElement(src.v.Span,null,DetailForm_ref3," ",react_default.a.createElement(index_es.FormattedRelative,{value:props.lastSave}))))):DetailForm_ref}}]),DetailForm}(react_default.a.Component);DetailForm_DetailForm.displayName="DetailForm";var components_DetailForm_DetailForm=Object(reduxForm.a)({form:"detailForm",destroyOnUnmount:!1})(DetailForm_DetailForm);function DetailFormContainer_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function DetailFormContainer_objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?DetailFormContainer_ownKeys(source,!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):DetailFormContainer_ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}DetailForm_DetailForm.__docgenInfo={description:"",methods:[{name:"isReadOnlyForm",docblock:null,modifiers:[],params:[],returns:null},{name:"isEntityLoaded",docblock:null,modifiers:[],params:[],returns:null},{name:"focusErrorFields",docblock:null,modifiers:[],params:[],returns:null},{name:"save",docblock:null,modifiers:[],params:[],returns:null},{name:"handleSubmit",docblock:null,modifiers:[],params:[{name:"event",type:null}],returns:null},{name:"handleKeyPress",docblock:null,modifiers:[],params:[{name:"event",type:null}],returns:null},{name:"showErrors",docblock:null,modifiers:[],params:[{name:"event",type:null}],returns:null},{name:"msg",docblock:null,modifiers:[],params:[{name:"id",type:null}],returns:null}],displayName:"DetailForm",props:{intl:{type:{name:"custom",raw:"intlShape.isRequired"},required:!1,description:""},mode:{type:{name:"enum",value:[{value:"'update'",computed:!1},{value:"'create'",computed:!1}]},required:!1,description:""},entityModel:{type:{name:"object"},required:!0,description:""},submitForm:{type:{name:"func"},required:!0,description:""},formDefinition:{type:{name:"object"},required:!0,description:""},entity:{type:{name:"object"},required:!0,description:""},form:{type:{name:"string"},required:!0,description:""},touch:{type:{name:"func"},required:!0,description:""},formValues:{type:{name:"object"},required:!1,description:""},submitting:{type:{name:"bool"},required:!1,description:""},formErrors:{type:{name:"object"},required:!1,description:""},valid:{type:{name:"bool"},required:!1,description:""},dirty:{type:{name:"bool"},required:!1,description:""},lastSave:{type:{name:"number"},required:!1,description:""},fireTouched:{type:{name:"func"},required:!0,description:""},touchAllFields:{type:{name:"func"},required:!0,description:""},anyTouched:{type:{name:"bool"},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/entity-detail/src/components/DetailForm/DetailForm.js"]={name:"DetailForm",docgenInfo:DetailForm_DetailForm.__docgenInfo,path:"packages/entity-detail/src/components/DetailForm/DetailForm.js"});var DetailFormContainer_mapActionCreators={unloadDetailView:unloadDetailView,submitForm:submitForm,fireTouched:function(touched){return{type:FIRE_TOUCHED,payload:{touched:touched}}},touchAllFields:function(){return{type:TOUCH_ALL_FIELDS}},logError:errorLogging.a.logError},DetailFormContainer=Object(es.connect)(function(state){return{formDefinition:state.entityDetail.formDefinition,entity:state.entityDetail.entity,entityModel:state.entityDetail.entityModel,formValues:Object(getFormValues.a)("detailForm")(state),formErrors:DetailFormContainer_objectSpread({},Object(getFormSyncErrors.a)("detailForm")(state),{},Object(getFormAsyncErrors.a)("detailForm")(state),{},Object(getFormSubmitErrors.a)("detailForm")(state),{_error:(formName="detailForm",function(state){return get_default()(state,"form.".concat(formName,".error"),{})})(state)}),formInitialValues:es_getFormInitialValues("detailForm")(state),lastSave:state.entityDetail.lastSave};var formName},DetailFormContainer_mapActionCreators)(Object(index_es.injectIntl)(components_DetailForm_DetailForm)),DetailView_DetailView=function(_React$Component){function DetailView(){var _getPrototypeOf2,_this;classCallCheck_default()(this,DetailView);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _this=possibleConstructorReturn_default()(this,(_getPrototypeOf2=getPrototypeOf_default()(DetailView)).call.apply(_getPrototypeOf2,[this].concat(args))),defineProperty_default()(assertThisInitialized_default()(_this),"handledAsyncValidate",function(values){return asyncValidate(values,_this.props.formInitialValues,_this.props.entityName,_this.props.entityId,_this.props.entityModel,_this.props.mode).catch(function(error){if(error instanceof asyncValidation_AsyncValidationException)throw error.errors;_this.props.logError("client.common.unexpectedError","client.entity-detail.validationError",error)})}),defineProperty_default()(assertThisInitialized_default()(_this),"getSyncValidation",function(){return _this.validateSingleton||isEmpty_default()(_this.props.entityModel)||(_this.validateSingleton=src_form.a.syncValidation(_this.props.entityModel)),_this.validateSingleton}),defineProperty_default()(assertThisInitialized_default()(_this),"msg",function(id){return _this.props.intl.formatMessage({id:id})}),_this}return inherits_default()(DetailView,_React$Component),createClass_default()(DetailView,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.unloadDetailView()}},{key:"render",value:function render(){var props=this.props;return react_default.a.createElement(src.i,{required:[props.formInitialValues],loadingText:this.msg("client.entity-detail.loadingText")},react_default.a.createElement(DetailFormContainer,{mode:this.props.mode,validate:this.getSyncValidation(),asyncValidate:this.handledAsyncValidate}))}}]),DetailView}(react_default.a.Component);DetailView_DetailView.displayName="DetailView";var components_DetailView_DetailView=DetailView_DetailView;DetailView_DetailView.__docgenInfo={description:"",methods:[{name:"handledAsyncValidate",docblock:null,modifiers:[],params:[{name:"values",type:null}],returns:null},{name:"getSyncValidation",docblock:null,modifiers:[],params:[],returns:null},{name:"msg",docblock:null,modifiers:[],params:[{name:"id",type:null}],returns:null}],displayName:"DetailView",props:{intl:{type:{name:"custom",raw:"intlShape.isRequired"},required:!1,description:""},mode:{type:{name:"enum",value:[{value:"'update'",computed:!1},{value:"'create'",computed:!1}]},required:!1,description:""},loadDetailView:{type:{name:"func"},required:!0,description:""},unloadDetailView:{type:{name:"func"},required:!0,description:""},logError:{type:{name:"func"},required:!0,description:""},entityModel:{type:{name:"object"},required:!0,description:""},entityName:{type:{name:"string"},required:!0,description:""},entityId:{type:{name:"string"},required:!1,description:""},formInitialValues:{type:{name:"shape",value:{initial:{name:"objectOf",value:{name:"string"},required:!1}}},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/entity-detail/src/components/DetailView/DetailView.js"]={name:"DetailView",docgenInfo:DetailView_DetailView.__docgenInfo,path:"packages/entity-detail/src/components/DetailView/DetailView.js"});var DetailViewContainer_mapActionCreators={loadDetailView:loadDetailView,unloadDetailView:unloadDetailView,logError:errorLogging.a.logError},DetailViewContainer=Object(es.connect)(function(state){return{entityName:state.entityDetail.entityName,entityId:state.entityDetail.entityId,entityModel:state.entityDetail.entityModel,mode:state.entityDetail.mode,formInitialValues:es_getFormInitialValues("detailForm")(state)}},DetailViewContainer_mapActionCreators)(Object(index_es.injectIntl)(components_DetailView_DetailView)),getDispatchActions=function(input){return[(entityName=input.entityName,{type:"entityDetail/SET_ENTITY_NAME",payload:{entityName:entityName}}),(entityId=input.entityId?input.entityId:null,{type:"entityDetail/SET_ENTITY_ID",payload:{entityId:entityId}}),(mode=input.mode,{type:"entityDetail/SET_MODE",payload:{mode:mode}}),(formName=input.formName,{type:"entityDetail/SET_FORM_NAME",payload:{formName:formName}}),(appId=input.id,{type:"entityDetail/SET_APP_ID",payload:{appId:appId}}),(defaultValues=input.defaultValues,{type:"entityDetail/SET_DEFAULT_VALUES",payload:{defaultValues:defaultValues}}),loadDetailView()];var defaultValues,appId,formName,mode,entityId,entityName},customActions={new:regenerator_default.a.mark(function _new(){return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Object(effects.d)(navigateToCreate());case 2:case"end":return _context.stop()}},_new)})},shortcuts=[{ctrl:!0,key:"s",action:submitForm()}],EXTERNAL_EVENTS=["onSubGridRowClick","onEntityCreated","onTouchedChange","emitAction","onNavigateToCreate"],main_ref=react_default.a.createElement(DetailViewContainer,null),initApp=function(id,input){var events=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},publicPath=3<arguments.length?arguments[3]:void 0,store=appFactory.a.createStore(reducers,reducers_sagas,input,"entity-detail");externalEvents.a.addToStore(store,events),actionEmitter.a.addToStore(store,events.emitAction),errorLogging.a.addToStore(store,!1),notifier.a.addToStore(store,!1),actions.a.addToStore(store,{formApp:main.a,listApp:src_main.a,customActions:customActions}),formData.a.addToStore(store,{listApp:src_main.a,linkFactory:input.linkFactory}),keyDown.a.addToStore(store,shortcuts);var dispatchActions=getDispatchActions(input),app=appFactory.a.createApp("entity-detail",main_ref,store,{input:input,events:events,actions:dispatchActions,publicPath:publicPath,textResourceModules:["component","common","entity-list"]});return app};appFactory.a.registerAppInRegistry("entity-detail",initApp);var main_EntityDetailApp=function(_React$Component){function EntityDetailApp(props){var _this;classCallCheck_default()(this,EntityDetailApp),_this=possibleConstructorReturn_default()(this,getPrototypeOf_default()(EntityDetailApp).call(this,props));var events=EXTERNAL_EVENTS.reduce(function(events,event){return props[event]&&(events[event]=props[event]),events},{});return _this.app=initApp("id",props,events),_this}return inherits_default()(EntityDetailApp,_React$Component),createClass_default()(EntityDetailApp,[{key:"render",value:function render(){return this.app.renderComponent()}}]),EntityDetailApp}(react_default.a.Component);main_EntityDetailApp.displayName="EntityDetailApp";var entity_detail_src_main=main_EntityDetailApp;function StyledEntityDetail_templateObject(){var data=taggedTemplateLiteral_default()(["\n   margin-bottom: ",";\n"]);return StyledEntityDetail_templateObject=function(){return data},data}main_EntityDetailApp.__docgenInfo={description:"",methods:[],displayName:"EntityDetailApp",props:{entityName:{type:{name:"string"},required:!0,description:""},formName:{type:{name:"string"},required:!0,description:""},mode:{type:{name:"enum",value:[{value:"'update'",computed:!1},{value:"'create'",computed:!1}]},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/entity-detail/src/main.js"]={name:"EntityDetailApp",docgenInfo:main_EntityDetailApp.__docgenInfo,path:"packages/entity-detail/src/main.js"});var StyledEntityDetailBackButton=styled_components_browser_esm.default.div(StyledEntityDetail_templateObject(),src.A.space(-1)),EntityDetail_EntityDetail=function(_React$Component){function EntityDetail(props){var _this;return classCallCheck_default()(this,EntityDetail),_this=possibleConstructorReturn_default()(this,getPrototypeOf_default()(EntityDetail).call(this,props)),defineProperty_default()(assertThisInitialized_default()(_this),"handleSubGridRowClick",function(_ref){var id=_ref.id,relationName=(_ref.gridName,_ref.relationName);_this.props.router.history.push("".concat(_this.props.router.match.url,"/").concat(relationName,"/").concat(id))}),defineProperty_default()(assertThisInitialized_default()(_this),"handleNavigateToCreate",function(relationName){if(relationName)_this.props.router.history.push("".concat(_this.props.router.match.url,"/").concat(relationName,"/"));else{var url=_this.props.router.match.url.replace(/\/$/,""),a=url.substring(0,url.lastIndexOf("/")+1);_this.props.router.history.push(a)}}),defineProperty_default()(assertThisInitialized_default()(_this),"handleEntityCreated",function(_ref2){var id=_ref2.id;_this.props.setFormTouched(!1);var url=_this.props.router.match.url;url="/"===url.substr(-1)?url:url+="/",_this.props.router.history.push("".concat(url).concat(id))}),defineProperty_default()(assertThisInitialized_default()(_this),"handleTouchedChange",function(_ref3){var touched=_ref3.touched;_this.props.setFormTouched(touched)}),defineProperty_default()(assertThisInitialized_default()(_this),"handleGoBack",function(){_this.props.router.history.push(_this.props.detailParams.parentUrl)}),defineProperty_default()(assertThisInitialized_default()(_this),"getApp",function(_ref4){var entityName=_ref4.entityName,entityId=_ref4.entityId,formName=_ref4.formName,mode=_ref4.mode;return react_default.a.createElement(entity_detail_src_main,{id:"".concat(_this.props.appId,"_detail_").concat(formName,"_").concat(entityId),entityName:entityName,entityId:entityId,formName:formName,mode:mode,onSubGridRowClick:_this.handleSubGridRowClick,onNavigateToCreate:_this.handleNavigateToCreate,onEntityCreated:_this.handleEntityCreated,onTouchedChange:_this.handleTouchedChange,emitAction:function emitAction(action){_this.props.dispatchEmittedAction(action)},theme:{}})}),defineProperty_default()(assertThisInitialized_default()(_this),"msg",function(id){return _this.props.intl.formatMessage({id:id})}),defineProperty_default()(assertThisInitialized_default()(_this),"render",function(){return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(react_router.a,{when:_this.props.formTouched,message:_this.msg("client.entity-browser.detail.confirmTouchedFormLeave")}),_this.props.detailParams&&react_default.a.createElement(react_default.a.Fragment,null,_this.props.detailParams.showBackButton&&react_default.a.createElement(StyledEntityDetailBackButton,null,react_default.a.createElement(src.a,{"data-cy":"entity-detail_back-button",icon:"chevron-left",label:_this.msg("client.entity-browser.back"),look:"raised",onClick:_this.handleGoBack})),_this.getApp(_this.props.detailParams)))}),_this.props.loadDetailParams(_this.props.router.match.url),_this.props.setFormTouched(!1),_this}return inherits_default()(EntityDetail,_React$Component),createClass_default()(EntityDetail,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.clearDetailParams()}}]),EntityDetail}(react_default.a.Component),components_EntityDetail_EntityDetail=EntityDetail_EntityDetail;EntityDetail_EntityDetail.__docgenInfo={description:"",methods:[{name:"handleSubGridRowClick",docblock:null,modifiers:[],params:[{name:"{id, gridName, relationName}",type:null}],returns:null},{name:"handleNavigateToCreate",docblock:null,modifiers:[],params:[{name:"relationName",type:null}],returns:null},{name:"handleEntityCreated",docblock:null,modifiers:[],params:[{name:"{id}",type:null}],returns:null},{name:"handleTouchedChange",docblock:null,modifiers:[],params:[{name:"{touched}",type:null}],returns:null},{name:"handleGoBack",docblock:null,modifiers:[],params:[],returns:null},{name:"getApp",docblock:null,modifiers:[],params:[{name:"{entityName, entityId, formName, mode}",type:null}],returns:null},{name:"msg",docblock:null,modifiers:[],params:[{name:"id",type:null}],returns:null},{name:"render",docblock:null,modifiers:[],params:[],returns:null}],displayName:"EntityDetail",props:{intl:{type:{name:"custom",raw:"intlShape.isRequired"},required:!1,description:""},dispatchEmittedAction:{type:{name:"func"},required:!0,description:""},loadDetailParams:{type:{name:"func"},required:!0,description:""},clearDetailParams:{type:{name:"func"},required:!0,description:""},setFormTouched:{type:{name:"func"},required:!0,description:""},router:{type:{name:"object"},required:!0,description:""},detailParams:{type:{name:"object"},required:!1,description:""},formTouched:{type:{name:"bool"},required:!1,description:""},showSubGridsCreateButton:{type:{name:"bool"},required:!1,description:""},appId:{type:{name:"string"},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/entity-browser/src/routes/detail/components/EntityDetail/EntityDetail.js"]={name:"EntityDetail",docgenInfo:EntityDetail_EntityDetail.__docgenInfo,path:"packages/entity-browser/src/routes/detail/components/EntityDetail/EntityDetail.js"});var components_EntityDetail=components_EntityDetail_EntityDetail,LOAD_DETAIL_PARAMS="root/LOAD_DETAIL_PARAMS",CLEAR_DETAIL_PARAMS="root/CLEAR_DETAIL_PARAMS",setDetailParams=function(detailParams){return{type:"root/SET_DETAIL_PARAMS",payload:{detailParams:detailParams}}},EntityDetailContainer_mapActionCreators={loadDetailParams:function(url){return{type:LOAD_DETAIL_PARAMS,payload:{url:url}}},clearDetailParams:function(){return{type:CLEAR_DETAIL_PARAMS}},setFormTouched:function(formTouched){return{type:"detailView/SET_FORM_TOUCHED",payload:{formTouched:formTouched}}},dispatchEmittedAction:actionEmitter.a.dispatchEmittedAction},EntityDetailContainer=Object(es.connect)(function(state){return{appId:state.entityBrowser.appId,detailParams:state.detail.detailParams,formTouched:state.detail.formTouched,locale:state.input.locale}},EntityDetailContainer_mapActionCreators)(Object(index_es.injectIntl)(components_EntityDetail)),entities_marked=regenerator_default.a.mark(entities_fetchModel);function entities_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function entities_objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?entities_ownKeys(source,!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):entities_ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}var entities_defaultModelTransformer=function(json){var model={};return json.fields.forEach(function(field){model[field.fieldName]=entities_objectSpread({},field)}),json.relations.forEach(function(relation){model[relation.relationName]=entities_objectSpread({type:"relation"},relation)}),model};function entities_fetchModel(entityName){var transformer,resp,_args=arguments;return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return transformer=1<_args.length&&void 0!==_args[1]?_args[1]:entities_defaultModelTransformer,_context.next=3,Object(effects.b)(rest.a.requestSaga,"entities/".concat(entityName,"/model"));case 3:return resp=_context.sent,_context.next=6,Object(effects.b)(transformer,resp.body);case 6:return _context.abrupt("return",_context.sent);case 7:case"end":return _context.stop()}},entities_marked)}__webpack_require__(103);var reducer_ACTION_HANDLERS,util_parseUrl=function(url){var parts=url.split("/").filter(function(part){return!!part}),lastPart=parts[parts.length-1],modelPaths=parts.filter(function(el,idx){return 1<idx&&0==idx%2});return isNaN(lastPart)?{modelPaths:modelPaths,entityId:void 0,parentUrl:"/"+parts.slice(0,-1).join("/")}:{modelPaths:modelPaths,entityId:parts[parts.length-1],parentUrl:"/"+parts.slice(0,-2).join("/")}},util_showBackButton=function(initialKey,modelPaths){return 0!==modelPaths.length||!initialKey||isNaN(initialKey)},detail_modes={CREATE:"create",UPDATE:"update"},detail={modes:detail_modes,getMode:function(entityId){return void 0===entityId?detail_modes.CREATE:detail_modes.UPDATE},getFormExtension:function(mode){return mode===detail_modes.CREATE?"_create":"_detail"}},modules_sagas_marked=regenerator_default.a.mark(sagas_sagas),modules_sagas_marked2=regenerator_default.a.mark(sagas_clearDetailParams),modules_sagas_marked3=regenerator_default.a.mark(loadEntityDetail),modules_sagas_marked4=regenerator_default.a.mark(getTargetEntity),entityBrowserSelector=function(state){return state.entityBrowser},inputSelector=function(state){return state.input};function sagas_sagas(){return regenerator_default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Object(effects.a)([Object(effects.c)(effects.i,LOAD_DETAIL_PARAMS,loadEntityDetail),Object(effects.c)(effects.i,CLEAR_DETAIL_PARAMS,sagas_clearDetailParams)]);case 2:case"end":return _context.stop()}},modules_sagas_marked)}function sagas_clearDetailParams(){return regenerator_default.a.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Object(effects.d)(setDetailParams(void 0));case 2:case"end":return _context2.stop()}},modules_sagas_marked2)}function loadEntityDetail(_ref){var payload,_ref2,modelPaths,entityId,parentUrl,_ref3,entityName,formBase,mode,targetEntityName,formName,formExtension,_ref4,initialKey,showBackButton,detailParams;return regenerator_default.a.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return payload=_ref.payload,_context3.next=3,Object(effects.b)(util_parseUrl,payload.url);case 3:return _ref2=_context3.sent,modelPaths=_ref2.modelPaths,entityId=_ref2.entityId,parentUrl=_ref2.parentUrl,_context3.next=9,Object(effects.e)(entityBrowserSelector);case 9:return _ref3=_context3.sent,entityName=_ref3.entityName,formBase=_ref3.formBase,_context3.next=14,Object(effects.b)(detail.getMode,entityId);case 14:if(mode=_context3.sent,targetEntityName=entityName,formName=formBase,!(modelPaths&&0<modelPaths.length)){_context3.next=22;break}return _context3.next=20,Object(effects.b)(getTargetEntity,entityName,modelPaths);case 20:targetEntityName=_context3.sent,formName="".concat(formBase,"_").concat(targetEntityName);case 22:return _context3.next=24,Object(effects.b)(detail.getFormExtension,mode);case 24:return formExtension=_context3.sent,formName+=formExtension,_context3.next=28,Object(effects.e)(inputSelector);case 28:return _ref4=_context3.sent,initialKey=_ref4.initialKey,_context3.next=32,Object(effects.b)(util_showBackButton,initialKey,modelPaths);case 32:return showBackButton=_context3.sent,detailParams={mode:mode,entityId:entityId,entityName:targetEntityName,formName:formName,parentUrl:parentUrl,showBackButton:showBackButton},_context3.next=36,Object(effects.d)(setDetailParams(detailParams));case 36:case"end":return _context3.stop()}},modules_sagas_marked3)}function getTargetEntity(entityName,modelPaths){var targetEntityName,model,i,path,relation;return regenerator_default.a.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return targetEntityName=entityName,_context4.next=3,Object(effects.b)(entities_fetchModel,targetEntityName);case 3:model=_context4.sent,i=0;case 5:if(!(i<modelPaths.length)){_context4.next=18;break}if(path=modelPaths[i],relation=model[path]){_context4.next=10;break}throw new Error("No such path '".concat(path,"' found on entity model '").concat(targetEntityName,"'"));case 10:if(targetEntityName=relation.targetEntity,!(i+1<modelPaths.length)){_context4.next=15;break}return _context4.next=14,Object(effects.b)(entities_fetchModel,targetEntityName);case 14:model=_context4.sent;case 15:i++,_context4.next=5;break;case 18:return _context4.abrupt("return",targetEntityName);case 19:case"end":return _context4.stop()}},modules_sagas_marked4)}var modules_reducer_ACTION_HANDLERS=(reducer_ACTION_HANDLERS={},defineProperty_default()(reducer_ACTION_HANDLERS,"detailView/SET_FORM_TOUCHED",src_reducer.a.singleTransferReducer("formTouched")),defineProperty_default()(reducer_ACTION_HANDLERS,"root/SET_DETAIL_PARAMS",src_reducer.a.singleTransferReducer("detailParams")),reducer_ACTION_HANDLERS),reducer_initialState={detailParams:void 0,formTouched:!1};var modules=function modules_reducer_reducer(){var state=0<arguments.length&&void 0!==arguments[0]?arguments[0]:reducer_initialState,action=1<arguments.length?arguments[1]:void 0,handler=modules_reducer_ACTION_HANDLERS[action.type];return handler?handler(state,action):state};__webpack_exports__.default={container:EntityDetailContainer,reducers:{detail:modules,form:reducer.a},sagas:[sagas_sagas]}}}]);
//# sourceMappingURL=10.df96cfb5cf7f06815b69.bundle.js.map