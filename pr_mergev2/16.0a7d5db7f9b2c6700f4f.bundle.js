(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{3406:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(16),__webpack_require__(27),__webpack_require__(18),__webpack_require__(71),__webpack_require__(28),__webpack_require__(22),__webpack_require__(32),__webpack_require__(33),__webpack_require__(15),__webpack_require__(19);var defineProperty=__webpack_require__(4),defineProperty_default=__webpack_require__.n(defineProperty),react=__webpack_require__(0),react_default=__webpack_require__.n(react),reducer=__webpack_require__(23),appFactory=__webpack_require__(74),prop_types=__webpack_require__(11),prop_types_default=__webpack_require__.n(prop_types),root=__webpack_require__(99),es=__webpack_require__(36),index_es=__webpack_require__(13),taggedTemplateLiteral=__webpack_require__(25),taggedTemplateLiteral_default=__webpack_require__.n(taggedTemplateLiteral),styled_components_browser_esm=__webpack_require__(6),src=(__webpack_require__(26),__webpack_require__(5)),helpers_extends=(__webpack_require__(24),__webpack_require__(159),__webpack_require__(48),__webpack_require__(38),__webpack_require__(602),__webpack_require__(77),__webpack_require__(52),__webpack_require__(41)),extends_default=__webpack_require__.n(helpers_extends),toConsumableArray=__webpack_require__(30),toConsumableArray_default=__webpack_require__.n(toConsumableArray);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(source,!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}var getAllPaths=function(sourceData){return Object.keys(sourceData.entities[0].paths)},getAllRelations=function(sourceData){return toConsumableArray_default()(new Set(sourceData.relations.map((function(r){return r.relationName}))))},getAllPathsAndRelations=function(sourceData){return[].concat(toConsumableArray_default()(getAllPaths(sourceData)),toConsumableArray_default()(getAllRelations(sourceData)))},_ref2=(prop_types_default.a.shape({entities:prop_types_default.a.arrayOf(prop_types_default.a.shape({key:prop_types_default.a.string.isRequired,model:prop_types_default.a.string.isRequired,paths:prop_types_default.a.objectOf(prop_types_default.a.shape({type:prop_types_default.a.string,writable:prop_types_default.a.bool,value:prop_types_default.a.any}))})).isRequired,relations:prop_types_default.a.arrayOf(prop_types_default.a.shape({entityKey:prop_types_default.a.string.isRequired,relationName:prop_types_default.a.string.isRequired,keys:prop_types_default.a.arrayOf(prop_types_default.a.string).isRequired})).isRequired,displays:prop_types_default.a.arrayOf(prop_types_default.a.shape({model:prop_types_default.a.string.isRequired,values:prop_types_default.a.arrayOf(prop_types_default.a.shape({key:prop_types_default.a.string.isRequired,display:prop_types_default.a.string.isRequired}))})).isRequired,labels:prop_types_default.a.objectOf(prop_types_default.a.string).isRequired,mergeStragegy:prop_types_default.a.shape({display:prop_types_default.a.string})}),react_default.a.createElement("input",{type:"checkbox"})),_ref3=react_default.a.createElement(index_es.FormattedMessage,{id:"client.merge.allRelations"}),ManyRelationsCheckBox=function(_ref){var entityData=_ref.entityData;return react_default.a.createElement(react_default.a.Fragment,null,_ref2,react_default.a.createElement(src.K.Span,null,_ref3," (",entityData.value.length,")"))},_ref5=react_default.a.createElement("input",{type:"checkbox"}),RelationsCheckBoxes=function(_ref4){return _ref4.entityData.value.map((function(value){return react_default.a.createElement("div",{key:"relation-checkbox-".concat(value.key)},_ref5,react_default.a.createElement(src.i,{type:"single-select",value:value}))}))},_ref7=react_default.a.createElement("input",{type:"radio"}),FormattedValueRadio=function(_ref6){var entityData=_ref6.entityData,type=entityData.type,mappedType={entity:"single-select"}[type]||type;return entityData.value?react_default.a.createElement(react_default.a.Fragment,null,_ref7,react_default.a.createElement(src.i,{type:mappedType,value:entityData.value})):null},MergeTable_CellRenderer=function(_ref8){var entityData=_ref8.rowData[_ref8.column.entityKey],type=entityData.type;return"relations"===type?react_default.a.createElement(ManyRelationsCheckBox,{entityData:entityData}):"entity-list"===type?react_default.a.createElement(RelationsCheckBoxes,{entityData:entityData}):react_default.a.createElement(FormattedValueRadio,{entityData:entityData})};MergeTable_CellRenderer.displayName="CellRenderer";var MergeTable_LabelCellRenderer=function(_ref9){var rowIdx=_ref9.rowIdx,sourceData=_ref9.sourceData,columnName=_ref9.allPaths[rowIdx];return react_default.a.createElement(src.K.B,null,sourceData.labels[columnName])};MergeTable_LabelCellRenderer.displayName="LabelCellRenderer";var _ref11=react_default.a.createElement(index_es.FormattedMessage,{id:"client.merge.saveButton"}),MergeTable=function(_ref10){var sourceData=_ref10.sourceData,executeMerge=_ref10.executeMerge,data=Object(react.useMemo)((function(){return sourceData?function(sourceData){var pathRows=getAllPaths(sourceData).map((function(path){return sourceData.entities.reduce((function(acc,e){var value=e.paths[path];if(value&&value.value){if("entity"===value.type){var display=sourceData.displays.find((function(d){return d.model===value.value.model})).values.find((function(v){return v.key===value.value.key})).display;value.value.display=display}"entity-list"===value.type&&(value.value=value.value.map((function(f){var display=sourceData.displays.find((function(d){return d.model===f.model})).values.find((function(v){return v.key===f.key})).display;return f.display=display,f})))}return _objectSpread({},acc,defineProperty_default()({},e.key,value))}),{__key:path})})),relationRows=getAllRelations(sourceData).map((function(relation){return sourceData.relations.filter((function(r){return r.relationName===relation})).reduce((function(acc,val){return _objectSpread({},acc,defineProperty_default()({},val.entityKey,{type:"relations",value:val.keys}))}),{__key:relation})}));return[].concat(toConsumableArray_default()(pathRows),toConsumableArray_default()(relationRows))}(sourceData):[]}),[sourceData]),columns=Object(react.useMemo)((function(){return sourceData?function(sourceData,PathCellRenderer,LabelCellRenderer){var pathColumns=sourceData.entities.map((function(entity){return{id:entity.key,entityKey:entity.key,label:sourceData.displays.find((function(d){return d.model===entity.model})).values.find((function(v){return v.key===entity.key})).display,resizable:!0,sorting:{sortable:!1},CellRenderer:PathCellRenderer}}));return[{id:"column-label",label:"",resizable:!0,sorting:{sortable:!1},CellRenderer:function CellRenderer(props){return react_default.a.createElement(LabelCellRenderer,extends_default()({},props,{sourceData:sourceData,allPaths:getAllPathsAndRelations(sourceData)}))}}].concat(toConsumableArray_default()(pathColumns))}(sourceData,MergeTable_CellRenderer,MergeTable_LabelCellRenderer):[]}),[sourceData]);return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(src.d,{onClick:executeMerge,look:"raised",ink:"primary"},_ref11),react_default.a.createElement(src.J,{columns:columns,data:data,selectionStyle:"none",dataLoadingInProgress:null===sourceData,onColumnPositionChange:function onColumnPositionChange(){}}))};MergeTable.__docgenInfo={description:"",methods:[],displayName:"MergeTable",props:{sourceData:{type:{name:"custom",raw:"sourceDataPropType"},required:!1,description:""},executeMerge:{type:{name:"func"},required:!0,description:""}}};var MergeTable_MergeTable=MergeTable;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/merge/src/components/MergeTable/MergeTable.js"]={name:"MergeTable",docgenInfo:MergeTable.__docgenInfo,path:"packages/merge/src/components/MergeTable/MergeTable.js"});var setSourceData=function(sourceData){return{type:"merge/SET_SOURCE_DATA",payload:{sourceData:sourceData}}},mapActionCreators={executeMerge:function(){return{type:"merge/EXECUTE_MERGE"}}},components_MergeTable=Object(es.connect)((function(state){return{sourceData:state.merge.sourceData}}),mapActionCreators)(Object(index_es.injectIntl)(MergeTable_MergeTable));function _templateObject(){var data=taggedTemplateLiteral_default()(["\n  margin: 5px;\n  height: 100%;\n  overflow: hidden;\n"]);return _templateObject=function(){return data},data}var StyledMerge=styled_components_browser_esm.default.div(_templateObject()),Merge_ref2=react_default.a.createElement("div",null,"Merge Response"),Merge_ref3=react_default.a.createElement(components_MergeTable,null),Merge=function(_ref){var initialize=_ref.initialize,mergeResponse=_ref.mergeResponse;return Object(react.useEffect)((function(){initialize()})),react_default.a.createElement(StyledMerge,null,mergeResponse?Merge_ref2:Merge_ref3)};Merge.displayName="Merge",Merge.__docgenInfo={description:"",methods:[],displayName:"Merge",props:{initialize:{type:{name:"func"},required:!0,description:""},mergeResponse:{type:{name:"object"},required:!1,description:""}}};var Merge_Merge=Merge;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/merge/src/components/Merge/Merge.js"]={name:"Merge",docgenInfo:Merge.__docgenInfo,path:"packages/merge/src/components/Merge/Merge.js"});var _ACTION_HANDLERS,MergeContainer_mapActionCreators={initialize:function(){return{type:"merge/INITIALIZE"}}},components_Merge=Object(es.connect)((function(state){return{mergeResponse:state.merge.mergeResponse}}),MergeContainer_mapActionCreators)(Object(index_es.injectIntl)(Merge_Merge)),regenerator=__webpack_require__(2),regenerator_default=__webpack_require__.n(regenerator),redux_saga_effects_npm_proxy_esm=(__webpack_require__(40),__webpack_require__(1)),rest=__webpack_require__(31),_marked=regenerator_default.a.mark(mainSagas),_marked2=regenerator_default.a.mark(sagas_initialize),_marked3=regenerator_default.a.mark(loadSourceData),_marked4=regenerator_default.a.mark(sagas_executeMerge),mergeSelector=function(state){return state.merge};function mainSagas(){return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Object(redux_saga_effects_npm_proxy_esm.a)([Object(redux_saga_effects_npm_proxy_esm.j)("merge/INITIALIZE",sagas_initialize),Object(redux_saga_effects_npm_proxy_esm.j)("merge/EXECUTE_MERGE",sagas_executeMerge)]);case 2:case"end":return _context.stop()}}),_marked)}function sagas_initialize(){var _ref,selection;return regenerator_default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Object(redux_saga_effects_npm_proxy_esm.f)(mergeSelector);case 2:return _ref=_context2.sent,selection=_ref.selection,_context2.next=6,Object(redux_saga_effects_npm_proxy_esm.b)(loadSourceData,selection);case 6:case"end":return _context2.stop()}}),_marked2)}function loadSourceData(selection){var options,response,sourceData;return regenerator_default.a.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return"nice2/rest/merge/sourceData",options={method:"POST",body:{selection:selection}},_context3.next=4,Object(redux_saga_effects_npm_proxy_esm.b)(rest.a.requestSaga,"nice2/rest/merge/sourceData",options);case 4:return response=_context3.sent,sourceData=response.body,_context3.next=8,Object(redux_saga_effects_npm_proxy_esm.e)(setSourceData(sourceData));case 8:case"end":return _context3.stop()}}),_marked3)}function sagas_executeMerge(){var options,response;return regenerator_default.a.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return"nice2/rest/merge/merge",options={method:"POST",body:{}},_context4.next=5,Object(redux_saga_effects_npm_proxy_esm.b)(rest.a.requestSaga,"nice2/rest/merge/merge",options);case 5:return response=_context4.sent,_context4.next=8,Object(redux_saga_effects_npm_proxy_esm.e)({type:"merge/SET_MERGE_RESPONSE",payload:{mergeResponse:response}});case 8:case"end":return _context4.stop()}}),_marked4)}var ACTION_HANDLERS=(_ACTION_HANDLERS={},defineProperty_default()(_ACTION_HANDLERS,"merge/SET_SELECTION",reducer.a.singleTransferReducer("selection")),defineProperty_default()(_ACTION_HANDLERS,"merge/SET_SOURCE_DATA",reducer.a.singleTransferReducer("sourceData")),defineProperty_default()(_ACTION_HANDLERS,"merge/SET_MERGE_RESPONSE",reducer.a.singleTransferReducer("mergeResponse")),_ACTION_HANDLERS),initialState={selection:null,sourceData:null,mergeResponse:null};function reducer_reducer(){var state=0<arguments.length&&void 0!==arguments[0]?arguments[0]:initialState,action=1<arguments.length?arguments[1]:void 0,handler=ACTION_HANDLERS[action.type];return handler?handler(state,action):state}reducer_reducer.__docgenInfo={description:"",methods:[],displayName:"reducer"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/merge/src/modules/merge/reducer.js"]={name:"reducer",docgenInfo:reducer_reducer.__docgenInfo,path:"packages/merge/src/modules/merge/reducer.js"});var merge_marked=regenerator_default.a.mark(sagas);function sagas(){return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Object(redux_saga_effects_npm_proxy_esm.a)([Object(redux_saga_effects_npm_proxy_esm.d)(mainSagas)]);case 2:case"end":return _context.stop()}}),merge_marked)}var reducers={merge:reducer_reducer},reducers_sagas=[sagas];function main_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}var EXTERNAL_EVENTS=["emitAction"],main_ref=react_default.a.createElement(components_Merge,null),initApp=function(id,input,events,publicPath){var selection,store=appFactory.a.createStore(reducers,reducers_sagas,input,"merge");return appFactory.a.createApp("merge",main_ref,store,{input:input,events:events,actions:[(selection=input.selection,{type:"merge/SET_SELECTION",payload:{selection:selection}})],publicPath:publicPath,textResourceModules:["component","common","merge"]})};appFactory.a.registerAppInRegistry("merge",initApp);var MergeApp=function(props){var events=EXTERNAL_EVENTS.reduce((function(events,event){return props[event]&&(events[event]=props[event]),events}),{});return initApp(0,props,events).component};MergeApp.propTypes=function main_objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?main_ownKeys(source,!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):main_ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}({selection:prop_types_default.a.object},EXTERNAL_EVENTS.reduce((function(propTypes,event){return propTypes[event]=prop_types_default.a.func,propTypes}),{}));__webpack_exports__.default=Object(root.hot)(MergeApp)}}]);
//# sourceMappingURL=16.0a7d5db7f9b2c6700f4f.bundle.js.map